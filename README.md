# Atlas AWS Terraform Module

<!-- BEGIN_TOC -->
<!-- @generated
WARNING: This section is auto-generated. Do not edit directly.
Changes will be overwritten when documentation is regenerated.
Run 'just gen-readme' to regenerate. -->
- [Public Preview Note](#public-preview-note)
- [Disclaimer](#disclaimer)
- [Examples](#examples)
- [Requirements](#requirements)
- [Providers](#providers)
- [Resources](#resources)
- [Required Variables](#required-variables)
- [AWS Cloud Provider Access](#aws-cloud-provider-access)
- [Encryption at Rest](#encryption-at-rest)
- [Private Link](#private-link)
- [Backup Export](#backup-export)
- [Optional Variables](#optional-variables)
- [Outputs](#outputs)
- [FAQ](#faq)
<!-- END_TOC -->

## Public Preview Note

The MongoDB Atlas AWS Module (Public Preview) simplifies Atlas-AWS integrations and embeds MongoDB's best practices as intelligent defaults. This preview validates that these patterns meet the needs of most workloads without constant maintenance or rework. We welcome your feedback and contributions during this preview phase. MongoDB formally supports this module from its v1 release onwards.

<!-- BEGIN_DISCLAIMER -->
## Disclaimer

One of this project's primary objectives is to provide durable modules that support non-breaking migration and upgrade paths. The v0 release (public preview) of the MongoDB Atlas AWS Module focuses on gathering feedback and refining the design. Upgrades from v0 to v1 may not be seamless. We plan to deliver a finalized v1 release early next year with long term upgrade support.  

<!-- END_DISCLAIMER -->
<!-- BEGIN_TABLES -->
<!-- @generated
WARNING: This section is auto-generated. Do not edit directly.
Changes will be overwritten when documentation is regenerated.
Run 'just gen-readme' to regenerate. -->
## Examples

Feature | Name
--- | ---
Encryption at Rest | [AWS KMS Integration](./examples/encryption)
Encryption at Rest | [AWS KMS Integration with Private Endpoint](./examples/encryption_private_endpoint)
Private Link | [AWS PrivateLink Endpoint](./examples/privatelink)
Private Link | [AWS PrivateLink Multi-Region](./examples/privatelink_multi_region)
Private Link | [AWS PrivateLink BYOE](./examples/privatelink_byoe)

<!-- END_TABLES -->
<!-- BEGIN_TF_DOCS -->
<!-- @generated
WARNING: This section is auto-generated by terraform-docs. Do not edit directly.
Changes will be overwritten when documentation is regenerated.
Run 'just docs' to regenerate.
-->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (>= 1.9)

- <a name="requirement_aws"></a> [aws](#requirement\_aws) (>= 6.0)

- <a name="requirement_mongodbatlas"></a> [mongodbatlas](#requirement\_mongodbatlas) (~> 2.1)

## Providers

The following providers are used by this module:

- <a name="provider_aws"></a> [aws](#provider\_aws) (>= 6.0)

- <a name="provider_mongodbatlas"></a> [mongodbatlas](#provider\_mongodbatlas) (~> 2.1)

## Resources

The following resources are used by this module:

- [mongodbatlas_private_endpoint_regional_mode.this](https://registry.terraform.io/providers/mongodb/mongodbatlas/latest/docs/resources/private_endpoint_regional_mode) (resource)
- [mongodbatlas_privatelink_endpoint.this](https://registry.terraform.io/providers/mongodb/mongodbatlas/latest/docs/resources/privatelink_endpoint) (resource)
- [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region) (data source)

<!-- BEGIN_TF_INPUTS_RAW -->
<!-- @generated
WARNING: This grouped inputs section is auto-generated. Do not edit directly.
Changes will be overwritten when documentation is regenerated.
Run 'just docs' to regenerate.
-->
## Required Variables

### project_id

MongoDB Atlas project ID

Type: `string`


## AWS Cloud Provider Access

Configure the AWS IAM role used by MongoDB Atlas. See the [AWS cloud provider access documentation](https://www.mongodb.com/docs/atlas/security/set-up-unified-aws-access/) for details.

_No variables in this section yet._

## Encryption at Rest

Configure encryption at rest using AWS KMS. See the [AWS encryption documentation](https://www.mongodb.com/docs/atlas/security-aws-kms/) for details.

### encryption

Encryption at rest configuration with AWS KMS.

Provide EITHER:
- `kms_key_arn` (user-provided KMS key)
- `create_kms_key.enabled = true` (module-managed KMS key)

**IAM Role Strategy:**
- `iam_role.create = false` (default): Uses the shared IAM role from `cloud_provider_access`. Recommended for most use cases where a single role manages all Atlas-AWS integrations.
- `iam_role.create = true`: Creates a dedicated IAM role for encryption. Use this when:
  - Security policies require separate roles per AWS service integration
  - You need different IAM paths or permissions boundaries for encryption
  - Audit requirements mandate role isolation between Atlas features

**Private Networking:**
When `require_private_networking = true`, Atlas creates a PrivateLink connection to AWS KMS on the Atlas side. This ensures traffic from Atlas to KMS stays on AWS's private network. No user-side AWS VPC endpoint is requiredâ€”Atlas manages the private connectivity.

Type:

```hcl
object({
  enabled     = optional(bool, false)
  kms_key_arn = optional(string)
  region      = optional(string)
  create_kms_key = optional(object({
    enabled                 = bool
    alias                   = optional(string, "alias/atlas-encryption")
    deletion_window_in_days = optional(number, 7)
    enable_key_rotation     = optional(bool, true)
    policy_override         = optional(string)
  }))
  require_private_networking = optional(bool, false)
  private_endpoint_regions   = optional(set(string), [])
  iam_role = optional(object({
    create               = optional(bool, false)
    name                 = optional(string)
    path                 = optional(string, "/")
    permissions_boundary = optional(string)
  }), { create = false })
})
```

Default: `{}`


## Private Link

Configure AWS PrivateLink endpoints for secure connectivity. See the [AWS PrivateLink documentation](https://www.mongodb.com/docs/atlas/security-private-endpoint/) for details.

### privatelink_endpoints

Multi-region PrivateLink endpoints. All regions must be UNIQUE.

Type:

```hcl
list(object({
  region     = string
  subnet_ids = list(string)
  security_group = optional(object({
    ids                 = optional(list(string))
    create              = optional(bool, true)
    name_prefix         = optional(string, "atlas-privatelink-")
    inbound_cidr_blocks = optional(list(string)) # null = VPC CIDR, [] = no rule
    inbound_source_sgs  = optional(set(string), [])
    from_port           = optional(number, 1024)
    to_port             = optional(number, 65535)
  }), {})
  tags = optional(map(string), {})
}))
```

Default: `[]`

### privatelink_byoe

BYOE Phase 2: Key must exist in privatelink_byoe_regions. AWS doesn't require private_endpoint_ip_address.

Type:

```hcl
map(object({
  vpc_endpoint_id = string
}))
```

Default: `{}`


## Backup Export

Configure backup snapshot export to AWS S3.

### backup_export

Backup snapshot export to S3 configuration.

Provide EITHER:
- `bucket_name` (user-provided S3 bucket)
- `create_s3_bucket.enabled = true` (module-managed S3 bucket)

When `iam_role.create = true`, creates a dedicated IAM role for backup export instead of using the shared role.

Type:

```hcl
object({
  enabled     = optional(bool, false)
  bucket_name = optional(string)
  create_s3_bucket = optional(object({
    enabled                 = bool
    name                    = optional(string)
    force_destroy           = optional(bool, false)
    versioning_enabled      = optional(bool, true)
    server_side_encryption  = optional(string, "aws:kms")
    block_public_acls       = optional(bool, true)
    block_public_policy     = optional(bool, true)
    ignore_public_acls      = optional(bool, true)
    restrict_public_buckets = optional(bool, true)
  }))
  iam_role = optional(object({
    create               = optional(bool, false)
    name                 = optional(string)
    path                 = optional(string, "/")
    permissions_boundary = optional(string)
  }), { create = false })
})
```

Default: `{}`


## Optional Variables

### aws_tags

Tags to apply to all AWS resources created by this module.

Type: `map(string)`

Default: `{}`

### cloud_provider_access

Cloud provider access configuration for Atlas-AWS integration.

- `create = true` (default): Creates a shared IAM role and Atlas authorization
- `create = false`: Use existing role via `existing.role_id` and `existing.iam_role_arn`
- `iam_role_name`: Custom name for the IAM role (default: atlas-{project_id_suffix}-{purpose})
- `iam_role_path`: IAM role path (default: /)
- `iam_role_permissions_boundary`: ARN of permissions boundary policy

Type:

```hcl
object({
  create = optional(bool, true)
  existing = optional(object({
    role_id      = string
    iam_role_arn = string
  }))
  iam_role_name                 = optional(string)
  iam_role_path                 = optional(string, "/")
  iam_role_permissions_boundary = optional(string)
})
```

Default: `{}`

### privatelink_byoe_regions

BYOE Phase 1: Key is user identifier, value is AWS region. Outputs endpoint_service_name.

Type: `map(string)`

Default: `{}`

### privatelink_endpoints_single_region

Single-region multi-endpoint pattern. All regions must MATCH (Atlas constraint).

Type:

```hcl
list(object({
  region     = string
  subnet_ids = list(string)
  security_group = optional(object({
    ids                 = optional(list(string))
    create              = optional(bool, true)
    name_prefix         = optional(string, "atlas-privatelink-")
    inbound_cidr_blocks = optional(list(string))
    inbound_source_sgs  = optional(set(string), [])
    from_port           = optional(number, 1024)
    to_port             = optional(number, 65535)
  }), {})
  tags = optional(map(string), {})
}))
```

Default: `[]`

<!-- END_TF_INPUTS_RAW -->

## Outputs

The following outputs are exported:

### <a name="output_encryption"></a> [encryption](#output\_encryption)

Description: Encryption at rest status and configuration

### <a name="output_encryption_at_rest_provider"></a> [encryption\_at\_rest\_provider](#output\_encryption\_at\_rest\_provider)

Description: Value for cluster's encryption\_at\_rest\_provider attribute

### <a name="output_privatelink"></a> [privatelink](#output\_privatelink)

Description: PrivateLink status per endpoint key

### <a name="output_privatelink_service_info"></a> [privatelink\_service\_info](#output\_privatelink\_service\_info)

Description: Atlas PrivateLink service info for BYOE pattern

### <a name="output_regional_mode_enabled"></a> [regional\_mode\_enabled](#output\_regional\_mode\_enabled)

Description: Whether private endpoint regional mode is enabled

### <a name="output_resource_ids"></a> [resource\_ids](#output\_resource\_ids)

Description: All resource IDs for data source lookups

### <a name="output_role_id"></a> [role\_id](#output\_role\_id)

Description: Atlas role ID for reuse with other Atlas-AWS features
<!-- END_TF_DOCS -->

## FAQ

### What is `provider_meta "mongodbatlas"` doing?

This block tracks module usage by updating the User-Agent of requests to Atlas:

```
User-Agent: terraform-provider-mongodbatlas/2.1.0 Terraform/1.13.1 module_name/atlas-aws module_version/0.1.0
```

- `provider_meta "mongodbatlas"` does not send any configuration-specific data, only the module's name and version for feature adoption tracking
- Use `export TF_LOG=debug` to see API requests with headers and responses
