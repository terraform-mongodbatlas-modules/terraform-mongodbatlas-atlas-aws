# Atlas AWS Terraform Module

<!-- BEGIN_TOC -->
<!-- @generated
WARNING: This section is auto-generated. Do not edit directly.
Changes will be overwritten when documentation is regenerated.
Run 'just gen-readme' to regenerate. -->
- [Public Preview Note](#public-preview-note)
- [Disclaimer](#disclaimer)
- [Examples](#examples)
- [Requirements](#requirements)
- [Providers](#providers)
- [Resources](#resources)
- [Required Variables](#required-variables)
- [AWS Cloud Provider Access](#aws-cloud-provider-access)
- [Encryption at Rest](#encryption-at-rest)
- [Private Link](#private-link)
- [Backup Export](#backup-export)
- [Optional Variables](#optional-variables)
- [Outputs](#outputs)
- [FAQ](#faq)
<!-- END_TOC -->

## Public Preview Note

The MongoDB Atlas AWS Module (Public Preview) simplifies Atlas-AWS integrations and embeds MongoDB's best practices as intelligent defaults. This preview validates that these patterns meet the needs of most workloads without constant maintenance or rework. We welcome your feedback and contributions during this preview phase. MongoDB formally supports this module from its v1 release onwards.

<!-- BEGIN_DISCLAIMER -->
## Disclaimer

One of this project's primary objectives is to provide durable modules that support non-breaking migration and upgrade paths. The v0 release (public preview) of the MongoDB Atlas AWS Module focuses on gathering feedback and refining the design. Upgrades from v0 to v1 may not be seamless. We plan to deliver a finalized v1 release early next year with long term upgrade support.  

<!-- END_DISCLAIMER -->
<!-- BEGIN_TABLES -->
<!-- @generated
WARNING: This section is auto-generated. Do not edit directly.
Changes will be overwritten when documentation is regenerated.
Run 'just gen-readme' to regenerate. -->
## Examples

Feature | Name
--- | ---

<!-- END_TABLES -->
<!-- BEGIN_TF_DOCS -->
<!-- @generated
WARNING: This section is auto-generated by terraform-docs. Do not edit directly.
Changes will be overwritten when documentation is regenerated.
Run 'just docs' to regenerate.
-->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (>= 1.9)

- <a name="requirement_aws"></a> [aws](#requirement\_aws) (~> 6.0)

- <a name="requirement_mongodbatlas"></a> [mongodbatlas](#requirement\_mongodbatlas) (~> 2.1)

## Providers

No providers.

## Resources

No resources.

<!-- BEGIN_TF_INPUTS_RAW -->
<!-- @generated
WARNING: This grouped inputs section is auto-generated. Do not edit directly.
Changes will be overwritten when documentation is regenerated.
Run 'just docs' to regenerate.
-->
## Required Variables

### project_id

MongoDB Atlas project ID

Type: `string`


## AWS Cloud Provider Access

Configure the AWS IAM role used by MongoDB Atlas. See the [AWS cloud provider access documentation](https://www.mongodb.com/docs/atlas/security/set-up-unified-aws-access/) for details.

_No variables in this section yet._

## Encryption at Rest

Configure encryption at rest using AWS KMS. See the [AWS encryption documentation](https://www.mongodb.com/docs/atlas/security-aws-kms/) for details.

### encryption

Encryption at rest configuration with AWS KMS.

Provide EITHER:
- `kms_key_arn` (user-provided KMS key)
- `create_kms_key.enabled = true` (module-managed KMS key)

When `iam_role.create = true`, creates a dedicated IAM role for encryption instead of using the shared role.

Type:

```hcl
object({
  enabled     = optional(bool, false)
  kms_key_arn = optional(string)
  region      = optional(string)
  create_kms_key = optional(object({
    enabled                 = bool
    alias                   = optional(string, "alias/atlas-encryption")
    deletion_window_in_days = optional(number, 7)
    enable_key_rotation     = optional(bool, true)
    policy_override         = optional(string)
  }))
  require_private_networking = optional(bool, false)
  private_endpoint_regions   = optional(set(string), [])
  iam_role = optional(object({
    create               = optional(bool, false)
    name                 = optional(string)
    path                 = optional(string, "/")
    permissions_boundary = optional(string)
  }))
})
```

Default: `{}`


## Private Link

Configure AWS PrivateLink endpoints for secure connectivity. See the [AWS PrivateLink documentation](https://www.mongodb.com/docs/atlas/security-private-endpoint/) for details.

### privatelink_endpoints

Module-managed PrivateLink endpoints.

Key is the user identifier (or AWS region if `region` is omitted).

Example:
```hcl
privatelink_endpoints = {
  us-east-1 = { subnet_ids = [aws_subnet.east.id] }
  us-west-2 = { subnet_ids = [aws_subnet.west.id] }
}
```

For custom keys:
```hcl
privatelink_endpoints = {
  primary = { region = "us-east-1", subnet_ids = [aws_subnet.east.id] }
}
```

Type:

```hcl
map(object({
  region             = optional(string)
  subnet_ids         = list(string)
  security_group_ids = optional(list(string))
  tags               = optional(map(string), {})
}))
```

Default: `{}`

### privatelink_byoe

BYOE endpoint details. Key must exist in `privatelink_byoe_regions`.

Provide after creating VPC endpoints externally using the `endpoint_service_name`
from module output `privatelink_service_info`.

Type:

```hcl
map(object({
  vpc_endpoint_id             = string
  private_endpoint_ip_address = string
}))
```

Default: `{}`


## Backup Export

Configure backup snapshot export to AWS S3.

### backup_export

Backup snapshot export to S3 configuration.

Provide EITHER:
- `bucket_name` (user-provided S3 bucket)
- `create_s3_bucket.enabled = true` (module-managed S3 bucket)

When `iam_role.create = true`, creates a dedicated IAM role for backup export instead of using the shared role.

Type:

```hcl
object({
  enabled     = optional(bool, false)
  bucket_name = optional(string)
  create_s3_bucket = optional(object({
    enabled                 = bool
    name                    = optional(string)
    force_destroy           = optional(bool, false)
    versioning_enabled      = optional(bool, true)
    server_side_encryption  = optional(string, "aws:kms")
    block_public_acls       = optional(bool, true)
    block_public_policy     = optional(bool, true)
    ignore_public_acls      = optional(bool, true)
    restrict_public_buckets = optional(bool, true)
  }))
  iam_role = optional(object({
    create               = optional(bool, false)
    name                 = optional(string)
    path                 = optional(string, "/")
    permissions_boundary = optional(string)
  }))
})
```

Default: `{}`


## Optional Variables

### aws_tags

Tags to apply to all AWS resources created by this module.

Type: `map(string)`

Default: `{}`

### cloud_provider_access

Cloud provider access configuration for Atlas-AWS integration.

- `create = true` (default): Creates a shared IAM role and Atlas authorization
- `create = false`: Use existing role via `existing.role_id` and `existing.iam_role_arn`
- `iam_role_name`: Custom name for the IAM role (default: atlas-role-{project_id_suffix})
- `iam_role_path`: IAM role path (default: /)
- `iam_role_permissions_boundary`: ARN of permissions boundary policy

Type:

```hcl
object({
  create = optional(bool, true)
  existing = optional(object({
    role_id      = string
    iam_role_arn = string
  }))
  iam_role_name                 = optional(string)
  iam_role_path                 = optional(string, "/")
  iam_role_permissions_boundary = optional(string)
})
```

Default: `{}`

### privatelink_byoe_regions

Atlas-side PrivateLink endpoints for BYOE (Bring Your Own Endpoint).
Key is user identifier, value is AWS region.

Use this for Phase 1 of BYOE pattern to get `endpoint_service_name` for creating
VPC endpoints outside of Terraform.

Type: `map(string)`

Default: `{}`

<!-- END_TF_INPUTS_RAW -->

## Outputs

No outputs.
<!-- END_TF_DOCS -->

## FAQ

### What is `provider_meta "mongodbatlas"` doing?

This block tracks module usage by updating the User-Agent of requests to Atlas:

```
User-Agent: terraform-provider-mongodbatlas/2.1.0 Terraform/1.13.1 module_name/atlas-aws module_version/0.1.0
```

- `provider_meta "mongodbatlas"` does not send any configuration-specific data, only the module's name and version for feature adoption tracking
- Use `export TF_LOG=debug` to see API requests with headers and responses
